<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Create&comma; build&comma; and test a backend application with a database using Microsoft Azure and Azure DevOps</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension vscode.markdown-math */
@font-face{font-family:KaTeX_AMS;font-style:normal;font-weight:400;src:url(fonts/KaTeX_AMS-Regular.woff2) format("woff2"),url(fonts/KaTeX_AMS-Regular.woff) format("woff"),url(fonts/KaTeX_AMS-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Caligraphic-Bold.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Bold.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Caligraphic-Regular.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Regular.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Fraktur-Bold.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Bold.woff) format("woff"),url(fonts/KaTeX_Fraktur-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Fraktur-Regular.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Regular.woff) format("woff"),url(fonts/KaTeX_Fraktur-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Main-Bold.woff2) format("woff2"),url(fonts/KaTeX_Main-Bold.woff) format("woff"),url(fonts/KaTeX_Main-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Main-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Main-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Main-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Main-Italic.woff2) format("woff2"),url(fonts/KaTeX_Main-Italic.woff) format("woff"),url(fonts/KaTeX_Main-Italic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Main-Regular.woff2) format("woff2"),url(fonts/KaTeX_Main-Regular.woff) format("woff"),url(fonts/KaTeX_Main-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Math-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Math-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Math-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Math-Italic.woff2) format("woff2"),url(fonts/KaTeX_Math-Italic.woff) format("woff"),url(fonts/KaTeX_Math-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:700;src:url(fonts/KaTeX_SansSerif-Bold.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Bold.woff) format("woff"),url(fonts/KaTeX_SansSerif-Bold.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:italic;font-weight:400;src:url(fonts/KaTeX_SansSerif-Italic.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Italic.woff) format("woff"),url(fonts/KaTeX_SansSerif-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:400;src:url(fonts/KaTeX_SansSerif-Regular.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Regular.woff) format("woff"),url(fonts/KaTeX_SansSerif-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Script;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Script-Regular.woff2) format("woff2"),url(fonts/KaTeX_Script-Regular.woff) format("woff"),url(fonts/KaTeX_Script-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size1;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size1-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size1-Regular.woff) format("woff"),url(fonts/KaTeX_Size1-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size2;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size2-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size2-Regular.woff) format("woff"),url(fonts/KaTeX_Size2-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size3;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size3-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size3-Regular.woff) format("woff"),url(fonts/KaTeX_Size3-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size4;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size4-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size4-Regular.woff) format("woff"),url(fonts/KaTeX_Size4-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Typewriter;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Typewriter-Regular.woff2) format("woff2"),url(fonts/KaTeX_Typewriter-Regular.woff) format("woff"),url(fonts/KaTeX_Typewriter-Regular.ttf) format("truetype")}.katex{text-rendering:auto;font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0}.katex *{-ms-high-contrast-adjust:none!important;border-color:currentColor}.katex .katex-version:after{content:"0.13.24"}.katex .katex-mathml{clip:rect(1px,1px,1px,1px);border:0;height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .mathit{font-family:KaTeX_Main;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-style:italic;font-weight:700}.katex .amsrm,.katex .mathbb,.katex .textbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak,.katex .textfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr,.katex .textscr{font-family:KaTeX_Script}.katex .mathsf,.katex .textsf{font-family:KaTeX_SansSerif}.katex .mathboldsf,.katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.katex .mathitsf,.katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{border-collapse:collapse;display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;position:relative;vertical-align:bottom}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;font-size:1px;min-width:2px;vertical-align:bottom;width:2px}.katex .vbox{align-items:baseline;display:inline-flex;flex-direction:column}.katex .hbox{width:100%}.katex .hbox,.katex .thinbox{display:inline-flex;flex-direction:row}.katex .thinbox{max-width:0;width:0}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline,.katex .hline,.katex .mfrac .frac-line,.katex .overline .overline-line,.katex .rule,.katex .underline .underline-line{min-height:1px}.katex .mspace{display:inline-block}.katex .clap,.katex .llap,.katex .rlap{position:relative;width:0}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{border:0 solid;display:inline-block;position:relative}.katex .hline,.katex .overline .overline-line,.katex .underline .underline-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline{border-bottom-style:dashed;display:inline-block;width:100%}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.83333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.16666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.66666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.45666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.14666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.85714286em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.46857143em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.96285714em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.55428571em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.66666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.77777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.88888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.30444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.76444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.58333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.66666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72833333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.07333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.41666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.48611111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.55555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.44027778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.72777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.28935185em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.34722222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.40509259em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.46296296em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.52083333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20023148em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.43981481em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.24108004em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.28929605em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.33751205em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.38572806em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.43394407em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48216008em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57859209em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69431051em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.83317261em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.19961427em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.20096463em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.24115756em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.28135048em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.32154341em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.36173633em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.40192926em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.48231511em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.57877814em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.69453376em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.83360129em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{position:relative}.katex .accent .accent-body:not(.accent-full){width:0}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;min-width:1px}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;display:block;height:inherit;position:absolute;width:100%}.katex svg path{stroke:none}.katex img{border-style:none;max-height:none;max-width:none;min-height:0;min-width:0}.katex .stretchy{display:block;overflow:hidden;position:relative;width:100%}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{overflow:hidden;position:relative;width:100%}.katex .halfarrow-left{left:0;overflow:hidden;position:absolute;width:50.2%}.katex .halfarrow-right{overflow:hidden;position:absolute;right:0;width:50.2%}.katex .brace-left{left:0;overflow:hidden;position:absolute;width:25.1%}.katex .brace-center{left:25%;overflow:hidden;position:absolute;width:50%}.katex .brace-right{overflow:hidden;position:absolute;right:0;width:25.1%}.katex .x-arrow-pad{padding:0 .5em}.katex .cd-arrow-pad{padding:0 .55556em 0 .27778em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox,.katex .fcolorbox{border:.04em solid;box-sizing:border-box}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.katex .angl{border-right:.049em solid;border-top:.049em solid;box-sizing:border-box;margin-right:.03889em}.katex .anglpad{padding:0 .03889em}.katex .eqn-num:before{content:"(" counter(katexEqnNo) ")";counter-increment:katexEqnNo}.katex .mml-eqn-num:before{content:"(" counter(mmlEqnNo) ")";counter-increment:mmlEqnNo}.katex .mtr-glue{width:50%}.katex .cd-vert-arrow{display:inline-block;position:relative}.katex .cd-label-left{display:inline-block;position:absolute;right:calc(50% + .3em);text-align:left}.katex .cd-label-right{display:inline-block;left:calc(50% + .3em);position:absolute;text-align:right}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}.katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.katex-display.fleqn>.katex{padding-left:2em;text-align:left}body{counter-reset:katexEqnNo mmlEqnNo}

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.katex-error {
	color: var(--vscode-editorError-foreground);
}

</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="create-build-and-test-a-backend-application-with-a-database-using-microsoft-azure-and-azure-devops">Create, build, and test a backend application with a database using Microsoft Azure and Azure DevOps</h1>
<h2 id="intro">Intro</h2>
<p>In this tech demo we're going to be using Microsoft Azure and Azure DevOps to create, test and build a CRUD API Node.js backend application that talks to a MySql database. This has been developed on a Windows machine leveraging Windows Subsystem for Linux (Ubuntu WSL v2 specifically) and Homebrew but the steps are similar on MacOS and Linux systems.</p>
<p>We're also assuming you already have an Azure account, Git, Node.js, MySql and Docker configured correctly on your machine.</p>
<h2 id="tech-stack">Tech stack</h2>
<ul>
<li><a href="http://expressjs.com">Express</a> is one of the most popular web frameworks for Node.js that supports routing, middleware, view system etc.</li>
<li><a href="https://sequelize.org">Sequelize</a> is a promise-based Node.js ORM that supports the dialects of most database systems out there.</li>
<li><a href="https://www.docker.com">Docker</a> provides lightweight containers to run services in isolation from our infrastructure so we can deliver software quickly.</li>
<li><a href="https://mochajs.org">Mocha</a> and <a href="https://www.chaijs.com">Chai</a> will be our framework and assertion library of choice when it comes to unit testing our app.</li>
<li><a href="https://dev.azure.com">Azure DevOps</a> is what we're going to be using to store our code, build our app, push containers and everything infrastructure-related.</li>
</ul>
<h2 id="creating-a-nodejs-app-with-express-mysql-and-sequelize">Creating a Node.js app with Express, MySql and Sequelize</h2>
<p>In this first section we're going to create our app so let's get right into it.</p>
<h2 id="create-a-repo-clone-it-and-initialize-the-project">Create a repo, clone it and initialize the project</h2>
<p>First things first: we're going to create a repository to store our code in Azure DevOps. You can use GitHub or any other version control system for this as well, but for this tech demo we're going to be focusing on Microsoft's tooling.</p>
<p>Go to <a href="https://dev.azure.com">Azure DevOps</a> and create your project.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\step1-create-project.jpg" alt="Create project"></li>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\step2-create-repo.jpg" alt="Create repo"></li>
</ul>
<p>Click on <code>Repos</code> and <code>Generate Git Credentials</code>.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\step3-generate-git-credentials.jpg" alt="Generate credentials"></li>
</ul>
<p>Clone the repo and provide the password given there .</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\step4-clone-repo.jpg" alt="Clone repo"></li>
</ul>
<p>Change directory to the recently-cloned repo directory and run <code>npm init</code> .</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\step5-npm-init.jpg" alt="Initialize repo"></li>
</ul>
<p>We need to install necessary modules: <em>express</em>, <em>sequelize</em>, <em>mysql2</em> and <em>cors</em>. Run: <code>npm install express sequelize mysql2 cors</code></p>
<p>The package.json file should now look like this:</p>
<pre><code class="language-json"><div>{
  <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;regent-tech-demo&quot;</span>,
  <span class="hljs-attr">&quot;description&quot;</span>: <span class="hljs-string">&quot;Regent tech demo&quot;</span>,
  <span class="hljs-attr">&quot;version&quot;</span>: <span class="hljs-string">&quot;1.0.0&quot;</span>,
  <span class="hljs-attr">&quot;license&quot;</span>: <span class="hljs-string">&quot;ISC&quot;</span>,
  <span class="hljs-attr">&quot;private&quot;</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">&quot;main&quot;</span>: <span class="hljs-string">&quot;src/server.js&quot;</span>,
  <span class="hljs-attr">&quot;scripts&quot;</span>: {
    <span class="hljs-attr">&quot;start&quot;</span>: <span class="hljs-string">&quot;node src/server.js&quot;</span>
  },
  <span class="hljs-attr">&quot;dependencies&quot;</span>: {
    <span class="hljs-attr">&quot;cors&quot;</span>: <span class="hljs-string">&quot;^2.8.5&quot;</span>,
    <span class="hljs-attr">&quot;express&quot;</span>: <span class="hljs-string">&quot;^4.18.1&quot;</span>,
    <span class="hljs-attr">&quot;mysql2&quot;</span>: <span class="hljs-string">&quot;^2.3.3&quot;</span>,
    <span class="hljs-attr">&quot;sequelize&quot;</span>: <span class="hljs-string">&quot;^6.21.6&quot;</span>
  }
}
</div></code></pre>
<h3 id="nodejs-rest-crud-api-application-overview">Node.js REST CRUD API application overview</h3>
<p>We will build REST API that can create, retrieve, update, delete and find consultants by specific skills.</p>
<p>First, we start with an Express web server. Next, we add configuration for MySQL database, create the consultant model with Sequelize, write the controller. Then we define routes for handling all CRUD operations (including custom finder).</p>
<p>The following table shows overview of the Rest APIs that will be exported:</p>
<table>
<thead>
<tr>
<th>Methods</th>
<th>URLs</th>
<th>Actions</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>api/consultants</td>
<td>get all consultants</td>
</tr>
<tr>
<td>GET</td>
<td>api/consultants/assigned</td>
<td>get all assigned consultants</td>
</tr>
<tr>
<td>POST</td>
<td>api/consultants</td>
<td>add new consultant</td>
</tr>
<tr>
<td>POST</td>
<td>api/consultants/skills</td>
<td>get all consultants by skills</td>
</tr>
<tr>
<td>PUT</td>
<td>api/consultants/update/:id</td>
<td>update consultant by id</td>
</tr>
<tr>
<td>DELETE</td>
<td>api/consultants/delete/:id</td>
<td>remove consultant by id</td>
</tr>
<tr>
<td>DELETE</td>
<td>api/consultants</td>
<td>remove all consultants</td>
</tr>
</tbody>
</table>
<p>Finally, we’re going to test the REST APIs using Postman.</p>
<h3 id="setup-express-web-server">Setup Express web server</h3>
<p>In the root folder of our repo, let’s create a new directory <code>src</code> and there we will create a <code>server.js</code> file:</p>
<pre><code class="language-js"><div><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>)
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;cors&quot;</span>)

<span class="hljs-keyword">const</span> app = express()

<span class="hljs-keyword">var</span> corsOptions = {
  <span class="hljs-attr">origin</span>: <span class="hljs-string">&quot;http://localhost:8081&quot;</span>
}

app.use(cors(corsOptions))

<span class="hljs-comment">// parse requests of content-type - application/json</span>
app.use(express.json())

<span class="hljs-comment">// parse requests of content-type - application/x-www-form-urlencoded</span>
app.use(express.urlencoded({ <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span> }))

<span class="hljs-comment">// simple route</span>
app.get(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.json({ <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Welcome to our Regent tech demo 🎉🎉🎉&quot;</span> });
})

app.use(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.status(<span class="hljs-number">404</span>).json({ <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;Route not found&#x27;</span> })
})

<span class="hljs-comment">// set port, listen for requests</span>
<span class="hljs-keyword">const</span> PORT = process.env.PORT || <span class="hljs-number">8080</span>;

<span class="hljs-keyword">const</span> server = app.listen(PORT, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Server is running on http://localhost:<span class="hljs-subst">${PORT}</span>`</span>)
})

<span class="hljs-built_in">module</span>.exports = server
</div></code></pre>
<p>What we are doing:</p>
<ul>
<li>importing <code>express</code>, and <code>cors</code> modules</li>
<li>creating an Express app, then addding body-parser (<code>json</code> and <code>urlencoded</code>) and <code>cors</code> middlewares using the <code>app.use()</code> method; notice that we set the origin to: <code>http://localhost:8081</code></li>
<li>defining a GET route which is simple for test</li>
<li>defining a basic 404 route</li>
<li>listening on port <code>8080</code> for incoming requests</li>
</ul>
<h3 id="configure-mysql-database--sequelize">Configure MySQL database &amp; Sequelize</h3>
<p>In the <code>src</code> folder we will create a separate config directory for configuration: <code>src/config/db.config.js</code> that will look like this:</p>
<pre><code class="language-js"><div><span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">HOST</span>: <span class="hljs-string">&quot;localhost&quot;</span>,
  <span class="hljs-attr">USER</span>: <span class="hljs-string">&quot;root&quot;</span>,
  <span class="hljs-attr">PASSWORD</span>: <span class="hljs-string">&quot;12345678&quot;</span>,
  <span class="hljs-attr">DB</span>: <span class="hljs-string">&quot;consultantsdb&quot;</span>,
  <span class="hljs-attr">dialect</span>: <span class="hljs-string">&quot;mysql&quot;</span>,
  <span class="hljs-attr">pool</span>: {
    <span class="hljs-attr">max</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">acquire</span>: <span class="hljs-number">30000</span>,
    <span class="hljs-attr">idle</span>: <span class="hljs-number">10000</span>
  }
}
</div></code></pre>
<p>First five parameters are for the MySQL connection. <code>pool</code> is optional, it will be used for Sequelize connection pool configuration:</p>
<ul>
<li><em>max</em>: maximum number of connection in pool</li>
<li><em>min</em>: minimum number of connection in pool</li>
<li><em>idle</em>: maximum time, in milliseconds, that a connection can be idle before being released</li>
<li><em>acquire</em>: maximum time, in milliseconds, that pool will try to get connection before throwing error</li>
</ul>
<h3 id="initialize-sequelize">Initialize Sequelize</h3>
<p>We’re gonna initialize Sequelize in <code>src/models</code> folder that will contain model in the next step. Create an <code>index.js</code> file in that directory with the following code:</p>
<pre><code class="language-js"><div><span class="hljs-keyword">const</span> dbConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../config/db.config.js&quot;</span>);

<span class="hljs-keyword">const</span> Sequelize = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;sequelize&quot;</span>);
<span class="hljs-keyword">const</span> sequelize = <span class="hljs-keyword">new</span> Sequelize(dbConfig.DB, dbConfig.USER, dbConfig.PASSWORD, {
  <span class="hljs-attr">host</span>: dbConfig.HOST,
  <span class="hljs-attr">dialect</span>: dbConfig.dialect,
  <span class="hljs-attr">operatorsAliases</span>: <span class="hljs-literal">false</span>,

  <span class="hljs-attr">pool</span>: {
    <span class="hljs-attr">max</span>: dbConfig.pool.max,
    <span class="hljs-attr">min</span>: dbConfig.pool.min,
    <span class="hljs-attr">acquire</span>: dbConfig.pool.acquire,
    <span class="hljs-attr">idle</span>: dbConfig.pool.idle
  }
});

<span class="hljs-keyword">const</span> db = {};

db.Sequelize = Sequelize;
db.sequelize = sequelize;

db.tutorials = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./consultants.model.js&quot;</span>)(sequelize, Sequelize);

<span class="hljs-built_in">module</span>.exports = db;
</div></code></pre>
<p>Don’t forget to import the models and call <code>sync()</code> in <code>server.js</code>:</p>
<pre><code class="language-js"><div>...
<span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./models&quot;</span>)

db.sequelize.sync()
  .then(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Synced db.&quot;</span>)
  })
  .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Failed to sync db: &quot;</span> + err.message)
  })
...
</div></code></pre>
<p>During development, you may need to drop existing tables and re-sync database. Just use <code>force: true</code> as following code:</p>
<pre><code class="language-js"><div>db.sequelize.sync({ <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> }).then(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Drop and re-sync db.&quot;</span>)
})
</div></code></pre>
<h3 id="define-the-sequelize-model">Define the Sequelize Model</h3>
<p>Create <code>src/models/consultants.model.js</code> file with the following content:</p>
<pre><code class="language-js"><div><span class="hljs-built_in">module</span>.exports = <span class="hljs-function">(<span class="hljs-params">sequelize, DataTypes</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> Consultant = sequelize.define(<span class="hljs-string">&#x27;consultant&#x27;</span>, {
    <span class="hljs-attr">name</span>: {
      <span class="hljs-attr">type</span>: DataTypes.STRING,
      <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">validate</span>: {
        <span class="hljs-attr">notEmpty</span>: <span class="hljs-literal">true</span>
      }
    },
    <span class="hljs-attr">skills</span>: {
      <span class="hljs-attr">type</span>: DataTypes.JSON,
      <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">validate</span>: {
        <span class="hljs-attr">notEmpty</span>: <span class="hljs-literal">true</span>
      }
    },
    <span class="hljs-attr">assigned</span>: {
      <span class="hljs-attr">type</span>: DataTypes.BOOLEAN
    }
  },
  {
    <span class="hljs-attr">indexes</span>: [
      { <span class="hljs-attr">unique</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">fields</span>: [<span class="hljs-string">&#x27;name&#x27;</span>] },
      { <span class="hljs-attr">unique</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">fields</span>: [<span class="hljs-string">&#x27;assigned&#x27;</span>] }
    ]
  })

  <span class="hljs-keyword">return</span> Consultant
}
</div></code></pre>
<p>This Sequelize model represents the consultants table in MySQL database. These columns will be generated automatically: <em>id</em>, <em>name</em>, <em>skills</em>, <em>assigned</em>.</p>
<h3 id="create-the-controller">Create the Controller</h3>
<p>Inside <code>src/controllers</code> directory, let’s create a file called <code>consultants.controller.js</code> with the following CRUD functions:</p>
<ul>
<li>create</li>
<li>findByName</li>
<li>findBySkills</li>
<li>findAllAssigned</li>
<li>update</li>
<li>delete</li>
<li>deleteAll</li>
</ul>
<pre><code class="language-js"><div><span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../models&quot;</span>)
<span class="hljs-keyword">const</span> Consultant = db.consultants
<span class="hljs-keyword">const</span> Op = db.Sequelize.Op

<span class="hljs-comment">// Create and save a new consultant</span>
<span class="hljs-built_in">exports</span>.create = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// Validate request</span>
  <span class="hljs-keyword">if</span> (!req.body.name) {
    res.status(<span class="hljs-number">400</span>).send({
      <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Name can not be empty!&quot;</span>
    })
    <span class="hljs-keyword">return</span> 
  }

  <span class="hljs-comment">// Create a consultant</span>
  <span class="hljs-keyword">const</span> consultant = {
    <span class="hljs-attr">name</span>: req.body.name,
    <span class="hljs-attr">skills</span>: req.body.skills,
    <span class="hljs-attr">assigned</span>: req.body.assigned ? req.body.assigned : <span class="hljs-literal">false</span>
  }

  <span class="hljs-comment">// Save consultant in the database</span>
  Consultant.create(consultant)
    .then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
      res.send(data)
    })
    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
      res.status(<span class="hljs-number">500</span>).send({
        <span class="hljs-attr">message</span>:
          err.message || <span class="hljs-string">&quot;Some error occurred while creating the consultant.&quot;</span>
      })
    })
}

<span class="hljs-comment">// Retrieve all consultants filtered by name</span>
<span class="hljs-built_in">exports</span>.findByName = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> name = req.query.name
  <span class="hljs-keyword">const</span> condition = name ? { <span class="hljs-attr">name</span>: { [Op.like]: <span class="hljs-string">`%<span class="hljs-subst">${name}</span>%`</span> } } : <span class="hljs-literal">null</span>

  Consultant.findAll({ <span class="hljs-attr">where</span>: condition })
    .then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
      res.send(data)
    })
    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
      res.status(<span class="hljs-number">500</span>).send({
        <span class="hljs-attr">message</span>:
          err.message || <span class="hljs-string">&quot;Some error occurred while retrieving consultants.&quot;</span>
      })
    })
}

<span class="hljs-comment">// Retrieve all consultants filtered by skills</span>
<span class="hljs-built_in">exports</span>.findBySkills = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// Validate request</span>
  <span class="hljs-keyword">if</span> (!req.body.skills) {
    res.status(<span class="hljs-number">400</span>).send({
      <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Skills can not be empty!&quot;</span>
    })
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">const</span> skills = req.body.skills
  <span class="hljs-keyword">const</span> condition = skills ? { <span class="hljs-attr">skills</span>: { [Op.and]: skills }} : <span class="hljs-literal">null</span>

  Consultant.findAll({ <span class="hljs-attr">where</span>: condition })
    .then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
      res.send(data)
    })
    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
      res.status(<span class="hljs-number">500</span>).send({
        <span class="hljs-attr">message</span>:
          err.message || <span class="hljs-string">&quot;Some error occurred while retrieving consultants.&quot;</span>
      })
    })
}

<span class="hljs-comment">// Find all assigned consultants</span>
<span class="hljs-built_in">exports</span>.findAllAssigned = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> condition = { <span class="hljs-attr">assigned</span>: <span class="hljs-literal">true</span> }

  Consultant.findAll({ <span class="hljs-attr">where</span>: condition })
    .then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
      res.send(data)
    })
    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
      res.status(<span class="hljs-number">500</span>).send({
        <span class="hljs-attr">message</span>:
          err.message || <span class="hljs-string">&quot;Some error occurred while retrieving consultants.&quot;</span>
      })
    })
}

<span class="hljs-comment">// Update a consultant identified by the id in the request</span>
<span class="hljs-built_in">exports</span>.update = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> id = req.params.id
  <span class="hljs-keyword">const</span> condition = { <span class="hljs-attr">id</span>: id } 

  Consultant.update(req.body, { <span class="hljs-attr">where</span>: condition })
    .then(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (num == <span class="hljs-number">1</span>) {
        res.send({
          <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Consultant was updated successfully.&quot;</span>
        })
      } <span class="hljs-keyword">else</span> {
        res.send({
          <span class="hljs-attr">message</span>: <span class="hljs-string">`Cannot update consultant with id=<span class="hljs-subst">${id}</span>. Maybe consultant was not found or req.body is empty!`</span>
        })
      }
    })
    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
      res.status(<span class="hljs-number">500</span>).send({
        <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Error updating consultant with id=&quot;</span> + id
      })
    })
}

<span class="hljs-comment">// Delete a consultant with the specified id in the request</span>
<span class="hljs-built_in">exports</span>.delete = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> id = req.params.id
  <span class="hljs-keyword">const</span> condition = { <span class="hljs-attr">id</span>: id } 

  Consultant.destroy({ <span class="hljs-attr">where</span>: condition })
    .then(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (num == <span class="hljs-number">1</span>) {
        res.send({
          <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Consultant was deleted successfully!&quot;</span>
        })
      } <span class="hljs-keyword">else</span> {
        res.send({
          <span class="hljs-attr">message</span>: <span class="hljs-string">`Cannot delete Consultant with id=<span class="hljs-subst">${id}</span>. Maybe Consultant was not found!`</span>
        })
      }
    })
    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
      res.status(<span class="hljs-number">500</span>).send({
        <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Could not delete Consultant with id=&quot;</span> + id
      })
    })
}

<span class="hljs-comment">// Delete all consultants from the database</span>
<span class="hljs-built_in">exports</span>.deleteAll = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> condition = {
    <span class="hljs-attr">where</span>: {},
    <span class="hljs-attr">truncate</span>: <span class="hljs-literal">false</span>
  }

  Consultant.destroy({ <span class="hljs-attr">where</span>: {}, <span class="hljs-attr">truncate</span>: <span class="hljs-literal">false</span> })
    .then(<span class="hljs-function"><span class="hljs-params">nums</span> =&gt;</span> {
      res.send({ <span class="hljs-attr">message</span>: <span class="hljs-string">`<span class="hljs-subst">${nums}</span> consultants were deleted successfully!`</span> })
    })
    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
      res.status(<span class="hljs-number">500</span>).send({
        <span class="hljs-attr">message</span>:
          err.message || <span class="hljs-string">&quot;Some error occurred while removing all consultants.&quot;</span>
      })
    })
}
</div></code></pre>
<h3 id="define-routes">Define Routes</h3>
<p>When a client sends a request to an endpoint using HTTP CRUD request (GET, POST, PUT, DELETE), we need to determine how the server will reponse by setting up the routes. Create a <code>src/routes/turorial.routes.js</code> file with content like this:</p>
<pre><code class="language-js"><div><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-params">app</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> consultants = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../controllers/consultants.controller.js&quot;</span>)
  <span class="hljs-keyword">const</span> router = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>).Router()

  <span class="hljs-comment">// Create a new consultant</span>
  router.post(<span class="hljs-string">&quot;/&quot;</span>, consultants.create)

  <span class="hljs-comment">// Retrieve all consultants by skills</span>
  router.post(<span class="hljs-string">&quot;/skills&quot;</span>, consultants.findBySkills)

  <span class="hljs-comment">// Retrieve all consultants by name</span>
  router.get(<span class="hljs-string">&quot;/&quot;</span>, consultants.findByName)

  <span class="hljs-comment">// Retrieve all assigned consultants</span>
  router.get(<span class="hljs-string">&quot;/assigned&quot;</span>, consultants.findAllAssigned)

  <span class="hljs-comment">// Update a consultant with id</span>
  router.put(<span class="hljs-string">&quot;/update/:id&quot;</span>, consultants.update)

  <span class="hljs-comment">// Delete a consultant with id</span>
  router.delete(<span class="hljs-string">&quot;/delete/:id&quot;</span>, consultants.delete)

  <span class="hljs-comment">// Delete all consultants</span>
  router.delete(<span class="hljs-string">&quot;/&quot;</span>, consultants.deleteAll)

  app.use(<span class="hljs-string">&#x27;/api/consultants&#x27;</span>, router)
}
</div></code></pre>
<p>You can see that we use the controller from <code>src/controllers/consultants.controller.js</code>
We also need to include routes in <code>server.js</code> (right before the 404 route, otherwise all response codes will end up being 404):</p>
<pre><code class="language-js"><div>...
<span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./routes/consultants.routes&quot;</span>)(app)

app.use(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.status(<span class="hljs-number">404</span>).json({ <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;Route not found&#x27;</span> })
})
...
</div></code></pre>
<h3 id="testing-the-api">Testing the API</h3>
<p>Here are some Postman examples of how to verify our application is working according to specifications. I've compiled a collection for the sake of simplicity: <a href="./screenshots/regent-tech-demo.postman_collection.json">Postman API testing collection</a></p>
<h3 id="conclusion">Conclusion</h3>
<p>So far, we’ve learned how to create a Node.js REST API application with an Express web server. We also know how to configure MySQL database &amp; Sequelize, create a Sequelize Model, write a controller and define routes for handling all CRUD operations. We've also tested that the APIs we created work as expected.</p>
<h2 id="docker-compose-overview">Docker Compose overview</h2>
<p>In this section, we will show how to dockerize our Node.js, Express and MySQL application using Docker Compose.</p>
<p>Now that we have a Node.js application working with a MySQL database, the problem is to containerize our system which requires more than one Docker container:</p>
<ul>
<li>Node.js for backend</li>
<li>MySQL for database</li>
</ul>
<p>Docker Compose helps us setup the system more easily and efficiently than with only Docker. We’re gonna following these steps:</p>
<ul>
<li>Create a Dockerfile for our app</li>
<li>Write Docker Compose configurations YAML file</li>
<li>Set environment variables for Docker Compose</li>
</ul>
<h3 id="configuring-the-app-for-docker">Configuring the app for Docker</h3>
<p>Firstly, let’s install the <code>dotenv</code> module: <code>npm i dotenv</code></p>
<p>Next we import dotenv in <code>server.js</code> and use <code>process.env</code> for setting the port.</p>
<pre><code class="language-js"><div>...
<span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;dotenv&quot;</span>).config();
...
<span class="hljs-keyword">const</span> PORT = process.env.APP_PORT || process.env.NODE_DOCKER_PORT
...
<span class="hljs-keyword">const</span> server = app.listen(process.env.NODE_DOCKER_PORT, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Server is running on http://localhost:<span class="hljs-subst">${PORT}</span>`</span>)
})

<span class="hljs-built_in">module</span>.exports = server
</div></code></pre>
<p>Then we need to modify the database configuration and initialization.</p>
<p><code>src/config/db.config.js</code>:</p>
<pre><code class="language-js"><div><span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">HOST</span>: process.env.DB_HOST,
  <span class="hljs-attr">USER</span>: process.env.DB_USER || process.env.MYSQLDB_USER,
  <span class="hljs-attr">PASSWORD</span>: process.env.DB_PASSWORD || process.env.MYSQLDB_ROOT_PASSWORD,
  <span class="hljs-attr">DB</span>: process.env.DB_NAME || process.env.MYSQLDB_DATABASE,
  <span class="hljs-attr">port</span>: process.env.DB_PORT || process.env.MYSQLDB_DOCKER_PORT,
  <span class="hljs-attr">dialect</span>: <span class="hljs-string">&quot;mysql&quot;</span>,
  <span class="hljs-attr">pool</span>: {
    <span class="hljs-attr">max</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">acquire</span>: <span class="hljs-number">30000</span>,
    <span class="hljs-attr">idle</span>: <span class="hljs-number">10000</span>
  }
}
</div></code></pre>
<p><code>src/models/index.js</code>:</p>
<pre><code class="language-js"><div><span class="hljs-keyword">const</span> dbConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../config/db.config.js&quot;</span>)
<span class="hljs-keyword">const</span> Sequelize = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;sequelize&quot;</span>)

<span class="hljs-keyword">const</span> sequelize = <span class="hljs-keyword">new</span> Sequelize(dbConfig.DB, dbConfig.USER, dbConfig.PASSWORD, {
  <span class="hljs-attr">host</span>: dbConfig.HOST,
  <span class="hljs-attr">dialect</span>: dbConfig.dialect,
  <span class="hljs-attr">port</span>: dbConfig.port,
  <span class="hljs-attr">operatorsAliases</span>: <span class="hljs-string">&quot;false&quot;</span>,
  <span class="hljs-attr">pool</span>: {
    <span class="hljs-attr">max</span>: dbConfig.pool.max,
    <span class="hljs-attr">min</span>: dbConfig.pool.min,
    <span class="hljs-attr">acquire</span>: dbConfig.pool.acquire,
    <span class="hljs-attr">idle</span>: dbConfig.pool.idle
  }
})

<span class="hljs-keyword">const</span> db = {}
db.Sequelize = Sequelize
db.sequelize = sequelize
db.consultants = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./consultants.model.js&quot;</span>)(sequelize, Sequelize)

<span class="hljs-built_in">module</span>.exports = db
</div></code></pre>
<p>We also need to make a <code>.env</code> file in the root directory that stores all necessary environment variables.
<code>/.env</code>:</p>
<pre><code class="language-yaml"><div><span class="hljs-string">MYSQLDB_USER=root</span>
<span class="hljs-string">MYSQLDB_ROOT_PASSWORD=12345678</span>
<span class="hljs-string">MYSQLDB_DATABASE=consultantsdb</span>
<span class="hljs-string">MYSQLDB_LOCAL_PORT=3307</span>
<span class="hljs-string">MYSQLDB_DOCKER_PORT=3306</span>
<span class="hljs-string">NODE_LOCAL_PORT=6868</span>
<span class="hljs-string">NODE_DOCKER_PORT=8080</span>
</div></code></pre>
<h3 id="create-a-dockerfile">Create a Dockerfile</h3>
<p>The Dockerfile defines a list of commands that Docker uses for setting up the Node.js application environment. So we create this file in the root directory. Because we will be using Docker Compose we won’t define all the configuration commands in this Dockerfile.
<code>/Dockerfile</code>:</p>
<pre><code class="language-dockerfile"><div><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">14</span>-slim

<span class="hljs-keyword">WORKDIR</span><span class="bash"> /regent-tech-demo</span>

<span class="hljs-keyword">COPY</span><span class="bash"> package*.json ./</span>

<span class="hljs-keyword">RUN</span><span class="bash"> npm ci</span>

<span class="hljs-keyword">COPY</span><span class="bash"> . ./</span>

<span class="hljs-keyword">ADD</span><span class="bash"> https://github.com/ufoscout/docker-compose-wait/releases/download/2.9.0/<span class="hljs-built_in">wait</span> /<span class="hljs-built_in">wait</span></span>
<span class="hljs-keyword">RUN</span><span class="bash"> chmod +x /<span class="hljs-built_in">wait</span></span>

<span class="hljs-keyword">CMD</span><span class="bash"> npm run start</span>
</div></code></pre>
<p>Let's explain some points:</p>
<ul>
<li><code>FROM</code>: install the image of the Node.js version</li>
<li><code>WORKDIR</code>: path of the working directory we're going to be creating</li>
<li><code>COPY</code>: copy <code>package.json</code> and <code>package-lock.json</code> files to the container, then the second one copies all the files inside the project directory; this is for cache optimization, so that if the application doesn't need to rebuild the previous steps if changes to the code are made, only if changes to Dockerfile configuration or <code>package*.json</code> files occured</li>
<li><code>RUN</code>: execute <code>npm ci</code> to install the dependencies according to the <code>package-lock.json</code> file</li>
<li><code>CMD</code>: run the script to start the application after the image is built</li>
<li>The wait script we're downloading and running before starting our server is there only to make sure the Express server waits until the MySql port is in use before starting, thereby avoiding any database connection errors.</li>
</ul>
<h3 id="write-docker-compose-configurations">Write Docker Compose configurations</h3>
<p>On the root of the project directory, we’re gonna create the <code>docker-compose.yml</code> file. Follow version 3 syntax defined by Docker:</p>
<pre><code class="language-yaml"><div><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.8&#x27;</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">mysql:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">env_file:</span> <span class="hljs-string">./.env</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=$MYSQLDB_ROOT_PASSWORD</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_DATABASE=$MYSQLDB_DATABASE</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">$MYSQLDB_LOCAL_PORT:$MYSQLDB_DOCKER_PORT</span> 
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">db:/var/lib/mysql</span>
  <span class="hljs-attr">app:</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">./</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">env_file:</span> <span class="hljs-string">./.env</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">$NODE_LOCAL_PORT:$NODE_DOCKER_PORT</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">sh</span> <span class="hljs-string">-c</span> <span class="hljs-string">&quot;/wait &amp;&amp; npm run start&quot;</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_HOST=mysql</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_USER=$MYSQLDB_USER</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_PASSWORD=$MYSQLDB_ROOT_PASSWORD</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_NAME=$MYSQLDB_DATABASE</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_PORT=$MYSQLDB_DOCKER_PORT</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">APP_PORT=$NODE_LOCAL_PORT</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">WAIT_HOSTS=mysql:$MYSQLDB_DOCKER_PORT</span>
    <span class="hljs-attr">stdin_open:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">tty:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">volumes:</span> 
  <span class="hljs-attr">db:</span>
</div></code></pre>
<p><code>mysql</code>:</p>
<ul>
<li><em>image</em>: official Docker image</li>
<li><em>restart</em>: configure the restart policy</li>
<li><em>env_file</em>: specify our <em>.env</em> file path</li>
<li><em>environment</em>: provide setting using environment variables</li>
<li><em>ports</em>: specify the ports that will be used</li>
<li><em>volumes</em>: map volume folders</li>
</ul>
<p><code>app</code>:</p>
<ul>
<li><em>depends_on</em>: dependency order, mysqldb is started before app</li>
<li><em>build</em>: configuration options that are applied at build time that we defined in the Dockerfile with relative path</li>
<li><em>environment</em>: environmental variables that Node application uses</li>
<li><em>stdin_open</em> and <em>tty</em>: keep open the terminal after building container</li>
</ul>
<p>You should note that the host port and the container port are different. Networked service-to-service communication uses the container port and connections from outside the network use the host port.</p>
<h3 id="run-the-app-with-docker-compose">Run the app with Docker Compose</h3>
<p>We can easily run the whole with only a single command: <code>docker-compose up</code>
Docker will pull the MySQL and Node.js images if the machine did not previously have them.
The services can be run on the background by adding the <code>-d</code> flag: <code>docker-compose up -d</code></p>
<p><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\docker-compose-up.jpg" alt="docker-compose up -d"></p>
<p>Now you can check the current working containers with <code>docker ps</code> and docker images with <code>docker images</code>:</p>
<p><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\docker-ps.jpg" alt="docker ps">
<img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\docker-images.jpg" alt="docker images"></p>
<h3 id="stop-the-application">Stop the Application</h3>
<p>Stopping all the running containers is also simple with a single command: <code>docker-compose down</code></p>
<p>If you need to stop and remove all containers, networks, and all images used by any service in docker-compose.yml file, use the command: <code>docker-compose down --rmi all</code></p>
<p><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\docker-compose-down.jpg" alt="docker-compose down --rmi all"></p>
<h3 id="testing-the-api-1">Testing the API</h3>
<p>We can use the <a href="./screenshots/regent-tech-demo.postman_collection.json">previous Postman examples</a> to test our application, but just keep in mind that we need to change the port from <code>8080</code> to <code>6868</code> for all the requests; as we mentioned earlier, the host port is not the same as the container port.</p>
<h3 id="conclusion-1">Conclusion</h3>
<p>In this part we’ve successfully created a Docker Compose file for our MySQL and Node.js application. Now we can deploy our app with Docker in a very simple way: using our <code>docker-compose.yml</code> file.</p>
<h2 id="unit-testing-overview">Unit testing overview</h2>
<p>For this app, we're going to be writing 2 types of unit tests: one will test the Sequelize model we've created and one to test the Express server itself.</p>
<p>For this, we're going need to install the <em>mocha</em>, <em>chai</em> and <em>sequelize-test-helpers</em> modules: <code>npm i --save-dev mocha chai chai-http sequelize-test-helpers</code>, more about these later.</p>
<h3 id="setting-up-mocha">Setting up Mocha</h3>
<p>Mocha is perfect for this scenario as it works out-of-the-box and requires no additional configuration. Once we've installed the node module, all we need to do is create a script in <code>package.json</code> that we can use to run the unit tests:</p>
<pre><code class="language-json"><div>...
  <span class="hljs-string">&quot;scripts&quot;</span>: {
    <span class="hljs-attr">&quot;start&quot;</span>: <span class="hljs-string">&quot;node src/server.js&quot;</span>,
    <span class="hljs-attr">&quot;test&quot;</span>: <span class="hljs-string">&quot;mocha&quot;</span>
  },
...
</div></code></pre>
<p>To stay organised, create a directory called <code>test</code> in the root of the application; this is where we're going to store our tests.</p>
<h3 id="testing-the-express-server">Testing the Express server</h3>
<p>We will start by creating a new file: <code>test/server.spec.js</code> and importing the required modules:</p>
<pre><code class="language-js"><div><span class="hljs-keyword">const</span> chai = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;chai&#x27;</span>)
<span class="hljs-keyword">const</span> expect = chai.expect
<span class="hljs-keyword">const</span> chaiHttp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;chai-http&#x27;</span>)

chai.use(chaiHttp)
chai.should()
</div></code></pre>
<p>Don't be thrown off by the lack of mocha-related imports; mocha will take care of that automagically, the <em>chai</em> and <em>chai-http</em> assersion libraries are all we really need here.</p>
<p>Writing tests is actually quite simple thanks to natural naming conventions and thankfully we designed our app to be testable from the start by exporting our server in the <code>server.js</code> file, so we can just import it in our test and it will come with our entire Express configuration: <code>const server = require('../src/server')</code></p>
<p>Next, we're going to be using the <em>describe-it-after</em> mocha hook syntax to format our tests. Here's what they will look like:</p>
<pre><code class="language-js"><div>describe(<span class="hljs-string">&#x27;Server initialization&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  it(<span class="hljs-string">&#x27;Existing route should return 200&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">done</span>) =&gt;</span> {
    chai
      .request(server)
      .get(<span class="hljs-string">&#x27;/&#x27;</span>)
      .end(<span class="hljs-function">(<span class="hljs-params">err, res</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) done(err)
        expect(res.status).to.equal(<span class="hljs-number">200</span>)
        expect(res.text).to.equal(<span class="hljs-string">&#x27;Welcome to our Regent tech demo 🎉🎉🎉&#x27;</span>)
        done()
      })
  })

  it(<span class="hljs-string">&#x27;Unexistant route should return 404&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">done</span>) =&gt;</span> {
    chai
      .request(server)
      .get(<span class="hljs-string">&#x27;/randomNonexistingPathHere&#x27;</span>)
      .end(<span class="hljs-function">(<span class="hljs-params">err, res</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) done(err)
        <span class="hljs-keyword">const</span> { error } = res.body
        expect(res.status).to.equal(<span class="hljs-number">404</span>)
        expect(error)
        expect(error).to.equal(<span class="hljs-string">&#x27;Route not found&#x27;</span>)
        done()
      })
  })

  after(<span class="hljs-function">() =&gt;</span> {
    server.close()
  })
})
</div></code></pre>
<p>The tests are pretty straightforward: we use <em>chai-http</em> to start our Express server and send 2 GET requests to it, one testing the default route and one testing the 404 route.
The use of the <code>done</code> callback is essential to asynchronous tests, such as those for database queries and API calls.
As you can see, in the <code>after</code> hook we're going to close our server to prevent unwanted background processes and so that the tests finish successfully; tests also pass when they return, and fail when they throw an error.</p>
<p>Executing this gives us the following:</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\unit-test-server.jpg" alt="server unit test"></li>
</ul>
<h3 id="testing-the-sequelize-model">Testing the Sequelize model</h3>
<p>We will start by creating a new file: <code>test/model.spec.js</code></p>
<p>Unit-testing Sequelize models efficiently, in isolation, such that you do not invoke a connection to the underlying database, presents a few challenges. That's why we're going to be using the <em>sequelize-test-helpers</em> node module.</p>
<p>As soon as the app first calls the model, Sequelize gets invoked and that’s going to attempt to make a connection to the database. This is both slow and, if there is no database running, it is likely to cause connection errors.</p>
<p>In our tests we therefore want to completely avoid having to require the model at all. We can of focus the test on the specific model we want to test. But for that to be of use we need to pass it an instantiated sequelize object, and a Sequelize DataTypes object.</p>
<p>The <em>sequelize-test-helpers</em> library provides a mock sequelize instance and a complete set of sequelize data types:</p>
<pre><code class="language-js"><div><span class="hljs-keyword">const</span> {
  sequelize,
  dataTypes,
  checkModelName,
  checkPropertyExists,
  checkNonUniqueIndex,
} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;sequelize-test-helpers&#x27;</span>)

<span class="hljs-keyword">const</span> ConsultantsModel = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../src/models/consultants.model&#x27;</span>)

describe(<span class="hljs-string">&#x27;src/models/consultants.model&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> Model = ConsultantsModel(sequelize, dataTypes)
  <span class="hljs-keyword">const</span> consultant = <span class="hljs-keyword">new</span> Model()

  context(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
    checkModelName(Model)(<span class="hljs-string">&#x27;consultant&#x27;</span>)
  })

  context(<span class="hljs-string">&#x27;properties&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
    [<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;skills&#x27;</span>, <span class="hljs-string">&#x27;assigned&#x27;</span>].forEach(checkPropertyExists(consultant))
  })

  context(<span class="hljs-string">&#x27;indexes&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
    [<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;assigned&#x27;</span>].forEach(checkNonUniqueIndex(consultant))
  })
})
</div></code></pre>
<p>This tests that the model’s name is the name we expect, that the model has the properties we expect and that the indexes are what we expect.</p>
<p>Of course, we can use the <em>sequelize-test-helpers</em> library for a lot more than just the above (it can be used to test associations, hooks, code that relies on models etc.), but it's a good starting point for familiarizing ourselves with writing unit tests for <em>sequelize</em>. More information can be found in the module's <a href="https://www.npmjs.com/package/sequelize-test-helpers">npmjs page</a>.</p>
<p>Executing the tests now gives us the following:</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\unit-test-sequelize.jpg" alt="model unit test"></li>
</ul>
<h2 id="using-docker-compose-in-azure-devops-pipeline">Using Docker Compose in Azure DevOps pipeline</h2>
<p>This section will showcase how to use docker-compose in Azure DevOps pipeline for building and publishing your containers to ACR (Azure Container Registry). Don't forget to push your code to the cloud, we're going to need it!</p>
<h3 id="container-registry-configuration">Container Registry configuration</h3>
<p>First things first, we need to go to <a href="https://portal.azure.com">Azure Portal</a> and <em>Create Container Registry</em>. This will also automatically create a <em>Resource Group</em> for us as well. We will use the <em>Container Registry</em> to store the images we're going to build with Azure DevOps.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-container-registry1.jpg" alt="container registry 1"></li>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-container-registry2.jpg" alt="container registry 2"></li>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-container-registry3.jpg" alt="container registry 3"></li>
</ul>
<p>One little thing to note is that we need to enable the <em>Admin user</em> for the registry we just created once it's finished deploying. This is to allow Azure DevOps to push and read from it.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-container-registry4.jpg" alt="container registry 4"></li>
</ul>
<h3 id="azure-devops-pipelines">Azure DevOps Pipelines</h3>
<p>Next we'll head over to <a href="https://dev.azure.com">Azure DevOps</a> and select <em>Pipelines</em> and create a <em>New pipeline</em>.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline0.jpg" alt="new pipeline"></li>
</ul>
<p>Select <em>Azure Repos Git</em> or whatever version control system you've pushed your code to.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline1.jpg" alt="vcs"></li>
</ul>
<p>Select your repository.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline2.jpg" alt="repo"></li>
</ul>
<p>Select the second <em>Docker</em> option.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline3.jpg" alt="docker"></li>
</ul>
<p>Validate and configure your settings. Don't worry if it specifies a Dockerfile there instead of the <code>docker-compose.yml</code> file, this is just going to create a skeleton pipeline that we will replace with the correct docker-compose configuration later on.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline4.jpg" alt="validate"></li>
</ul>
<p>Click on the <em>Show asssistant</em> button on the right side of the screen to pop up the <em>Tasks</em> menu.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline5.jpg" alt="assistant"></li>
</ul>
<p>Search for the Docker Compose task and select the first option.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline6.jpg" alt="docker compose task"></li>
</ul>
<p>Complete the mandatory fields. When it prompts you to select your <em>Azure subscription</em> make sure to select the <em>Service sonnections</em> and not the <em>Subscription</em> option; they may look identical but actually only one will work. Also make sure the path to the <em>docker-compose.yaml</em> file is correct; the default option works for us in this case.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline7.jpg" alt="docker compose options"></li>
</ul>
<p>Make sure the cursor for the editor on the left is on an empty line at the end of the file and click <em>Add</em>. It should automatically populate the <em>azure-pipelines.yaml</em> file editor with the correct pipeline configuration, albeit the indentation will be wrong. Moving it 2 tabs to the right will fix it.</p>
<h3 id="running-tests-in-the-pipeline">Running tests in the pipeline</h3>
<p>While replacing the default Docker configuration with this new docker-compose configuration will generally take care of building and pushing the image to ACR, we would like to also test our code before pushing the image to make sure it's a valid image. To do this, we're going to split the pipeline into 3 different steps:</p>
<ol>
<li>Build the image</li>
<li>Run unit tests</li>
<li>Push the image to ACR</li>
</ol>
<p>Here is what the main pipeline code will look like:</p>
<pre><code class="language-yaml"><div><span class="hljs-string">...</span>
<span class="hljs-attr">stages:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">stage:</span> <span class="hljs-string">Build</span>
  <span class="hljs-attr">displayName:</span> <span class="hljs-string">Build,</span> <span class="hljs-string">test</span> <span class="hljs-string">and</span> <span class="hljs-string">push</span> <span class="hljs-string">stage</span>
  <span class="hljs-attr">jobs:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job:</span> <span class="hljs-string">Build</span>
    <span class="hljs-attr">displayName:</span> <span class="hljs-string">Build</span> <span class="hljs-string">test</span> <span class="hljs-string">and</span> <span class="hljs-string">push</span> <span class="hljs-string">job</span>
    <span class="hljs-attr">pool:</span>
      <span class="hljs-attr">vmImage:</span> <span class="hljs-string">$(vmImageName)</span>
    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">task:</span> <span class="hljs-string">DockerCompose@0</span>
      <span class="hljs-attr">displayName:</span> <span class="hljs-string">Build</span> <span class="hljs-string">image</span> <span class="hljs-string">from</span> <span class="hljs-string">Docker</span> <span class="hljs-string">Container</span>
      <span class="hljs-attr">inputs:</span>
        <span class="hljs-attr">containerregistrytype:</span> <span class="hljs-string">&#x27;Azure Container Registry&#x27;</span>
        <span class="hljs-attr">azureSubscription:</span> <span class="hljs-string">&#x27;Azure subscription 1(71c1734c-598d-453b-ad3a-c306e837ec9f)&#x27;</span>
        <span class="hljs-attr">azureContainerRegistry:</span> <span class="hljs-string">&#x27;{&quot;loginServer&quot;:&quot;regenttechdemo.azurecr.io&quot;, &quot;id&quot; : &quot;/subscriptions/71c1734c-598d-453b-ad3a-c306e837ec9f/resourceGroups/regent-tech-demo/providers/Microsoft.ContainerRegistry/registries/regenttechdemo&quot;}&#x27;</span>
        <span class="hljs-attr">dockerComposeFile:</span> <span class="hljs-string">&#x27;**/docker-compose.yml&#x27;</span>
        <span class="hljs-attr">action:</span> <span class="hljs-string">&#x27;Build services&#x27;</span>
        <span class="hljs-attr">includeSourceTags:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">includeLatestTag:</span> <span class="hljs-literal">true</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">task:</span> <span class="hljs-string">Docker@2</span>
      <span class="hljs-attr">displayName:</span> <span class="hljs-string">&#x27;Run tests inside container&#x27;</span>
      <span class="hljs-attr">inputs:</span>
        <span class="hljs-attr">repository:</span> <span class="hljs-string">&#x27;regenttechdemo_app&#x27;</span>
        <span class="hljs-attr">containerRegistry:</span> <span class="hljs-string">$(imageRepository)</span>
        <span class="hljs-attr">command:</span> <span class="hljs-string">&#x27;run&#x27;</span>
        <span class="hljs-attr">arguments:</span> <span class="hljs-string">&#x27;$(containerRegistry)/regenttechdemo_app:$(latestTag) npm run test&#x27;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">task:</span> <span class="hljs-string">DockerCompose@0</span>
      <span class="hljs-attr">displayName:</span> <span class="hljs-string">Push</span> <span class="hljs-string">image</span> <span class="hljs-string">to</span> <span class="hljs-string">Azure</span> <span class="hljs-string">Container</span> <span class="hljs-string">Registry</span>
      <span class="hljs-attr">inputs:</span>
        <span class="hljs-attr">containerregistrytype:</span> <span class="hljs-string">&#x27;Azure Container Registry&#x27;</span>
        <span class="hljs-attr">azureSubscription:</span> <span class="hljs-string">&#x27;Azure subscription 1(71c1734c-598d-453b-ad3a-c306e837ec9f)&#x27;</span>
        <span class="hljs-attr">azureContainerRegistry:</span> <span class="hljs-string">&#x27;{&quot;loginServer&quot;:&quot;regenttechdemo.azurecr.io&quot;, &quot;id&quot; : &quot;/subscriptions/71c1734c-598d-453b-ad3a-c306e837ec9f/resourceGroups/regent-tech-demo/providers/Microsoft.ContainerRegistry/registries/regenttechdemo&quot;}&#x27;</span>
        <span class="hljs-attr">dockerComposeFile:</span> <span class="hljs-string">&#x27;**/docker-compose.yml&#x27;</span>
        <span class="hljs-attr">action:</span> <span class="hljs-string">&#x27;Push services&#x27;</span>
</div></code></pre>
<p>Note that, while we're using <code>DockerCompose@0</code> tasks to build and push the image, we're using a <code>Docker@2</code> task to start and run commands within the container (in this case, tests).</p>
<p>When you feel happy with the pipeline, clicking on <em>Save and run</em> should automatically commit the <em>azure-pipelines.yaml</em> file to your repository's root directory and start building the application.</p>
<h3 id="checking-the-results">Checking the results</h3>
<p>To check the build status and output we will again head over to <a href="https://dev.azure.com">Azure DevOps</a> and select <em>Pipelines</em>.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline8.jpg" alt="pipeline status 1"></li>
</ul>
<p>Clicking on the recently-created pipeline and on the automatically started run will send us to a <em>Summary</em> of the run where we can easily check the build status.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline9.jpg" alt="pipeline status 2"></li>
</ul>
<p>Clicking on the job on the bottom will allow us to see the build output. Here we can see the 3 steps we have created earlier.</p>
<ul>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline10.jpg" alt="step 1"></li>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline11.jpg" alt="step 2"></li>
<li><img src="file:///c:\Users\AntonDragan\Git\regent-tech-demo\screenshots\azure-devops-pipeline12.jpg" alt="step 3"></li>
</ul>
<h2 id="conclusion-2">Conclusion</h2>
<p>Hope this tech demo helped provide a basic understanding over how to create, test and build an application using Microsoft's Azure platform and tooling.</p>
<p>Happy coding!</p>

        <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </body>
    </html>